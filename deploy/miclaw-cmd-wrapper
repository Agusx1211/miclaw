#!/usr/bin/env bash
set -euo pipefail

# Host-side SSH forced-command wrapper for miclaw.
# Install at /usr/local/sbin/miclaw-cmd-wrapper and configure authorized_keys:
#   restrict,command="/usr/local/sbin/miclaw-cmd-wrapper"

ALLOWED_COMMANDS=("git" "docker" "systemctl" "journalctl")

cmd="$SSH_ORIGINAL_COMMAND"
read -r command_base _ <<< "$cmd"

for allowed in "${ALLOWED_COMMANDS[@]}"; do
    if [ "$command_base" = "$allowed" ]; then
        exec $cmd
    fi
done

echo "denied: $cmd" >&2
exit 1
